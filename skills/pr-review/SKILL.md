---
name: pr-review
description: PRレビュー。PR番号・ブランチ名指定時またはレビュー依頼時に使用。Claude CodeとGPT-5.2-highのマルチモデルレビューでCritical/High/Medium分類の指摘を報告。
---

# PRレビュー

## トリガー条件

- PRレビューを依頼された場合
- PR番号またはブランチ名が指定された場合

## 実行手順

### 1. PR情報の取得

```bash
# PR詳細を取得
gh pr view <番号> --json title,body,author,headRefName,baseRefName,files

# diffを取得
gh pr diff <番号> > /tmp/pr-<番号>.diff
```

### 2. PJルールの確認

CLAUDE.mdを読み、以下を把握:
- アーキテクチャルール
- 命名規則
- コーディング規約

### 3. Claude Codeによるレビュー

変更された各ファイルについて:
1. Readツールでファイル全体を読む（diffだけでなく）
2. 既存パターンとの整合性を確認
3. 問題点を特定

### 4. agent cliによるレビュー（ループ）

別モデルの観点を追加。

**初回呼び出し**:
```bash
agent -p "メモリディレクトリ <フルパス> の内容を読み、以下のPRをレビューしてください:
- コードの品質（バグ、セキュリティ、パフォーマンス）
- 設計の妥当性
- テストの十分性
- ドキュメントの必要性

指摘がなければ「指摘なし」とだけ回答してください。

PR情報:
タイトル: <タイトル>
ブランチ: <ブランチ>

変更内容:
$(cat /tmp/pr-<番号>.diff)" \
  --model gpt-5.2-high \
  --output-format json
```

**2回目以降**（セッション継続）:
```bash
agent --resume <session_id> -p "以下の改善を行いました: <改善内容>。再度レビューしてください。" \
  --model gpt-5.2-high \
  --output-format json
```

**ループ条件**:
1. レビュー実行（メモリディレクトリのフルパスを明示）
2. 「絶対にやるべき」指摘は必ず修正を依頼/実施
3. それ以外の指摘はやる/やらない判断、または AskUserQuestion で確認
4. 修正後、`--resume`でセッション継続し「改善したこと」を伝達
5. 修正すべき点がなくなるまで繰り返し

### 5. 結果の統合

Claude Codeとagentの両方の指摘を統合し、以下の形式でレポート:

```markdown
# PRレビュー: #<番号>

## 対象
- PR: #<番号> - <タイトル>
- ブランチ: <ブランチ> → <ベース>

## Claude Codeによる指摘

### Critical
- [指摘内容]

### High
- [指摘内容]

## agent (gpt-5.2-high) による指摘

### Critical
- [指摘内容]

### High
- [指摘内容]

## 統合サマリ

| 観点 | Claude Code | agent | 統合判断 |
|------|------------|--------|---------|
| セキュリティ | OK | OK | OK |
| パフォーマンス | 指摘あり | OK | 要確認 |

## 推奨アクション
1. [アクション1]
2. [アクション2]

## マージ推奨: [Yes/No/条件付き]
```

## 問題の分類

| 分類 | 説明 | 対応 |
|-----|------|------|
| Critical | バグ、セキュリティ、破壊的変更 | マージ前に必須修正 |
| High | アーキテクチャ違反、テスト不足 | 強く推奨 |
| Medium | 命名、コメント | 改善推奨 |
| Good | 良い実装 | 賞賛 |
